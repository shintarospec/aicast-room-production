# 新機能追加時のコードレビューチェックリスト

## 🚨 必須チェック項目（既存機能保護）

### 1. URL・エンドポイント関連
- [ ] 既存のCloud Functions URLを変更していないか？
- [ ] 新しいURLはconfig.pyで管理されているか？
- [ ] ハードコードされたURLが追加されていないか？

### 2. データベース関連
- [ ] 既存テーブルの構造を変更していないか？
- [ ] 既存のクエリに影響する変更がないか？
- [ ] 新しいテーブルは独立して設計されているか？

### 3. 認証・セキュリティ関連
- [ ] 既存の認証フローを変更していないか？
- [ ] 新しい認証要件が既存機能に影響しないか？
- [ ] 環境変数の変更が既存機能に影響しないか？

### 4. スケジューラー関連
- [ ] 既存のcron設定を変更していないか？
- [ ] 新しいスケジューラーは独立したファイルか？
- [ ] 既存のスケジューラーロジックを変更していないか？

### 5. UI関連
- [ ] 既存の画面レイアウトを壊していないか？
- [ ] 既存のボタン・フォームの動作を変更していないか？
- [ ] 新しいUI要素は既存要素と競合しないか？

### 6. テスト投稿関連
- [ ] テスト投稿に「テスト」「test」などの明示的な文言を使用していないか？
- [ ] `Config.get_test_post()` で絵文字のみのテスト投稿を使用しているか？
- [ ] `Config.is_safe_test_content()` でテスト内容の安全性をチェックしているか？
- [ ] テストアカウントは `Config.get_test_account_id()` を使用しているか？
- [ ] ハードコードされたアカウントID（特に'shinrepoto'）を使用していないか？

## 📋 テスト要項

### 既存機能のテスト
- [ ] 投稿スケジュール機能が正常動作するか？
- [ ] UI送信ボタンが正常動作するか？
- [ ] 自動スケジューラーが正常動作するか？
- [ ] 各キャストのアカウント割り当てが正しいか？

### 新機能のテスト
- [ ] 新機能が独立して動作するか？
- [ ] 新機能のエラーが既存機能に影響しないか？
- [ ] 新機能の設定が既存設定を上書きしないか？

## ⚠️ 危険な変更パターン

### 絶対にしてはいけないこと
1. **既存のURL・エンドポイントの変更**
2. **既存のデータベーススキーマの変更**
3. **既存の環境変数の削除・変更**
4. **既存のcron設定の上書き**
5. **既存の関数の引数・戻り値の変更**

### 推奨する安全な変更方法
1. **新機能は独立したファイル・モジュールで実装**
2. **設定はconfig.pyで一元管理**
3. **新しいテーブルは既存テーブルと独立**
4. **新しいスケジューラーは独立したcron設定**
5. **既存関数を変更せず、新しい関数を作成**

## 🔍 コードレビュー時の確認コマンド

```bash
# 既存機能への影響確認
git diff --name-only HEAD~1  # 変更ファイル一覧
git diff HEAD~1 -- app.py | grep -E "(Cloud|URL|endpoint)"  # URL変更確認
sqlite3 casting_office.db ".schema" | diff - <(git show HEAD~1:schema.sql)  # DB変更確認

# 設定ファイルの確認
python3 -c "from config import Config; print(Config.get_cloud_functions_url())"

# 既存機能のテスト
python3 local_schedule_checker.py  # スケジューラーテスト
python3 test_existing_functions.py  # 既存機能テスト（作成予定）
```

## 📝 変更ログテンプレート

```
## 変更内容
- 新機能: [機能名]
- 影響範囲: [新規/既存への影響なし/既存への軽微な影響]

## 既存機能保護チェック
- [ ] URL・エンドポイント: 変更なし
- [ ] データベース: 新テーブルのみ追加
- [ ] 認証: 変更なし
- [ ] スケジューラー: 独立実装
- [ ] UI: 既存要素に影響なし

## テスト結果
- [ ] 既存投稿機能: 正常
- [ ] 既存スケジューラー: 正常
- [ ] 新機能: 正常
- [ ] 統合テスト: 正常
```

このチェックリストを必ず確認してから変更をコミットしてください！